<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Sunday, April 06, 2025, 1:40 AM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "Bartocs_Utilities" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Bartocs_Utilities"
   author="Bartoc"
   id="6d4e36a79496f60815dc8dab"
   language="Lua"
   purpose="Useful functions"
   save_state="y"
   date_written="2025-04-06 01:38:52"
   requires="5.07"
   version="1.0"
   >

</plugin>


<!--  Aliases  -->

<aliases>
  <alias
   match="spellup"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>BeginSpellup()</send>
  </alias>
  <alias
   match="lib"
   enabled="y"
   sequence="100"
  >
  <send>invsort type "bag aardwolf"</send>
  </alias>
  <alias
   match="^drink$"
   enabled="y"
   regexp="y"
   sequence="100"
  >
  <send>gulp decanter aardwolf</send>
  </alias>
  <alias
   match="pib *"
   enabled="y"
   sequence="100"
  >
  <send>put %1 in "bag aardwolf"</send>
  </alias>
  <alias
   match="request"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>QuestFunction("request")</send>
  </alias>
  <alias
   match="restock"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>Restock()</send>
  </alias>
  <alias
   match="speeddelay"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>Note(GetSpeedWalkDelay())</send>
  </alias>
  <alias
   match="k *"
   sequence="100"
  >
  <send>spellup silent
k %1</send>
  </alias>
  <alias
   match="cquest"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>QuestFunction("complete")</send>
  </alias>
    <alias
   match="dump gmcp ([\w]+)"
   enabled="y"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>DumpGMCP("%1")</send>
  </alias>
  <alias
   match="deletelines"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>DebugDeleteLines(5)</send>
  </alias>
  <alias
   match="fquest"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>QuestFunction("fail")</send>
  </alias>
  <alias
   match="gfb *"
   enabled="y"
   sequence="100"
  >
  <send>get %1 from "bag aardwolf"</send>
  </alias>
  <alias
   match="corpse"
   enabled="y"
   sequence="100"
  >
  <send>get all corpse
wear all</send>
  </alias>
  <alias
   match="stealth"
   enabled="y"
   sequence="100"
  >
  <send>shadow
chameleon</send>
  </alias>
</aliases>

<!--  Variables  -->


<!--  Script  -->


<script>
<![CDATA[


function DebugDeleteLines(number)
	DeleteLines(number)
end


require "mw_theme_base"
require "serialize"
require "movewindow"
require "commas"
require "copytable"
require "table"
require "themed_miniwindows"
require "tprint"
require "wait"
require 'gmcphelper'

spellup_length = 0
successes = 0
failures = 0
beginbar = true
bar = ""

function OnPluginInstall()
  Note("Bartoc's Utilities refreshed.")
end

function QuestFunction(var)
  SmartRecall()
  Send("runto quest")
  Send("quest " .. var)
  Send("runto recall")
end

function Restock()
  SmartRecall()
  Send("runto manorv")
  Send("run 2nu")
  Send("buy 40 Potion")
  -- Send("buy 20 Ether")
  Send("recall")
end



function SmartRecall()
  if not (gmcp("room.info.zone") == "aylor") then Send("recall") end
end

SpellupWindow = ThemedTextWindow(
   GetPluginID(),  -- string, required, a unique identifier for this window
   0,  -- integer, required, where to put it if the player hasn't moved it
   0,  -- integer, required, where to put it if the player hasn't moved it
   400,  -- integer, required, how big to make it if the player hasn't moved it
   50,  -- integer, required, how big to make it if the player hasn't moved it
   "Spellup",  -- string, optional (nil means no titlebar), text to put into the title
   "center",  -- string, optional (default is "center"), "left", "center", or "right"
   false,  -- boolean, optional (default is false), true adds a close button in the top left
   false,  -- boolean, optional (default is false), make the window resizeable
   false,  -- boolean, optional (default is false), add a scrollbar and mousewheel scrolling
   false,  -- boolean, optional (default is false), make the text selectable
   false,  -- boolean, optional (default is false), make the text copyable via right-click
   false,  -- boolean, optional (default is false), turn detected URLs into clickable links
   false,  -- boolean, optional (default is false), automatically wrap text lines that are too wide
   nil,  -- string, optional (default is Dina), override the title font name
   nil,  -- integer, optional (default is 10), override the title font size
   nil,  -- string, optional (default is Dina), override the body text font name
   10,  -- integer, optional (default is 10), override the body text font size
   nil,  -- integer, optional (default is 1000), maximum number of text lines to keep
   nil,  -- integer, optional (default is 5 pixels), space between text and miniwindow frame
   true,  -- boolean, optional (default is false), true will prevent the window from appearing until you call :show() on it
   false  -- boolean, optional (default is false), if true, pixels the same color as Theme.PRIMARY_BODY will be transparent
)



function BeginSpellup()
  spellup_length = 0
  successes = 0
  failures = 0
  barframe = " "
  loadbar = ""
  beginbar = true
  Note("Spelling up...")
  Send("spellup")
  SpellupWindow:clear()
  EnableTriggerGroup("cleanspellup", true)
  SpellupWindow:show()
end


function CountSpells()
  spellup_length = spellup_length + 1
  barframe = barframe .. "_"
end


function UpdateSpellupBar(result)


  if result == "success" then
    successes = successes + 1
    loadbar = loadbar .. "@C#"
  else
    failures = failures + 1
    loadbar = loadbar .. "@r#"
  end
  Note("successes: " .. successes .. "  Failures: " .. failures .. "  Spell Count: " .. spellup_length)
  if (successes + failures) == spellup_length then
    if successes == spellup_length then
      SpellupWindow:clear()
      SpellupWindow:add_text("[" .. loadbar .. "]  @GOK")
      SpellupWindow:draw()
    else
      SpellupWindow:clear()
      SpellupWindow:add_text("[" .. loadbar .. "]  @RFailures: " .. failures)
      SpellupWindow:draw()
    end
    --wait.time(2)
    SpellupWindow:hide()
    EnableTriggerGroup("cleanspellup", false)
  else
    SpellupWindow:clear()
    --SpellupWindow:add_text(barframe)
    SpellupWindow:add_text("[" .. loadbar)
    --SpellupWindow:add_text(barframe)
    SpellupWindow:draw()
  end
end


function DumpGMCP(var)
  table = gmcp(var)
  Note(dump(table))
end


function ClearNewline (name, line, wildcards)
  DeleteLines (1)
  --SpellupWindow:clear()
  --SpellupWindow:add_text(loadbar)
  --Tell(loadbar)
  --if (successes + failures) >= spellup_length then
  --  WindowShow("SpellupWindow", false)
  --  EnableTriggerGroup("cleanspellup", false)
  --end
end


function dump(o)
   if type(o) == 'table' then
      local s = '{ '
      for k,v in pairs(o) do
         if type(k) ~= 'number' then k = '"'..k..'"' end
         s = s .. '['..k..'] = ' .. dump(v) .. ','
      end
      return s .. '} '
   else
      return tostring(o)
   end
end


]]>
</script>


<triggers>
    <trigger
    enabled="n"
    group="cleanspellup"
    name="countspells"
    match="Queueing s[pk][ei]ll : (([,'\-\w]\s?)+)(?<!\s)"
    omit_from_output="y"
    regexp="y"
    send_to="12"
    sequence="100"
    >
    <send>CountSpells()</send>
    </trigger>
    <trigger
    enabled="n"
    group="cleanspellup"
    name="countfailures"
    match="^You lost your concentration.*[\r\n]{1,2}"
    omit_from_output="y"
    regexp="y"
    send_to="12"
    sequence="99"
    >
    <send>UpdateSpellupBar("failure")</send>
    </trigger>
    <trigger
    enabled="n"
    group="cleanspellup"
    name="countsuccesses"
    match="^[AY][yon\s].*"
    omit_from_output="y"
    regexp="y"
    send_to="12"
    sequence="101"
    >
    <send>UpdateSpellupBar("success")</send>
    </trigger>
    <trigger
    enabled="n"
    group="cleanspellup"
    name="clearspaces"
    match="^$"
    omit_from_output="y"
    regexp="y"
    sequence="101"
    script="ClearNewline"
    >
    </trigger>
    <trigger
    enabled="y"
    match="is auctioning Tendrils of the Void"
    omit_from_output="y"
    regexp="y"
    sequence="101"
    >
    </trigger>

</triggers>

</muclient>
