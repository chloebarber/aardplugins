<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Sunday, April 06, 2025, 1:40 AM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "Bartocs_Utilities" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Bartocs_Utilities"
   author="Bartoc"
   id="6d4e36a79496f60815dc8dab"
   language="Lua"
   purpose="Useful functions"
   save_state="y"
   date_written="2025-04-06 01:38:52"
   requires="5.07"
   version="1.0"
   >

</plugin>


<!--  Aliases  -->

<aliases>
  <alias
   match="spellup"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>BeginSpellup()</send>
  </alias>
  <alias
   match="lib"
   enabled="y"
   sequence="100"
  >
  <send>invsort type "bag aardwolf"</send>
  </alias>
  <alias
   match="pib *"
   enabled="y"
   sequence="100"
  >
  <send>put %1 in "bag aardwolf"</send>
  </alias>
  <alias
   match="request"
   enabled="y"
   sequence="100"
  >
  <send>recall
runto quest
quest request
runto recall</send>
  </alias>
  <alias
   match="restock"
   enabled="y"
   sequence="100"
  >
  <send>recall
runto manorv
run 2nu
buy Potion 20
buy Ether 20
recall</send>
  </alias>
  <alias
   match="speeddelay"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>Note(GetSpeedWalkDelay())</send>
  </alias>
  <alias
   match="k *"
   sequence="100"
  >
  <send>spellup silent
k %1</send>
  </alias>
  <alias
   match="cquest"
   enabled="y"
   sequence="100"
  >
  <send>recall
runto quest
quest complete
runto recall</send>
  </alias>
  <alias
   match="deletelines"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>DebugDeleteLines(5)</send>
  </alias>
  <alias
   match="fquest"
   enabled="y"
   sequence="100"
  >
  <send>recall
runto quest
quest fail
runto recall</send>
  </alias>
  <alias
   match="gfb *"
   enabled="y"
   sequence="100"
  >
  <send>get %1 from "bag aardwolf"</send>
  </alias>
  <alias
   match="corpse"
   enabled="y"
   sequence="100"
  >
  <send>get all corpse
wear all</send>
  </alias>
  <alias
   match="buffs *"
   enabled="y"
   sequence="100"
  >
  <send>cast "test of faith" %1
cast "call upon faith"
cast "divine faith" %1
cast "spirit shield" %1
cast "sanctuary" %1
cast "bless" %1
cast "aid" %1
cast "detect good" %1
cast "detect evil" %1</send>
  </alias>
</aliases>

<!--  Variables  -->


<!--  Script  -->


<script>
<![CDATA[
function DebugDeleteLines(number)
	DeleteLines(number)
end

require "mw_theme_base"
require "serialize"
require "movewindow"
require "commas"
require "copytable"
require "table"
require "themed_miniwindows"
require "tprint"

spellup_length = 0
successes = 0
failures = 0
beginbar = true
bar = ""

SpellupWindow = ThemedTextWindow(
   GetPluginID(),  -- string, required, a unique identifier for this window
   0,  -- integer, required, where to put it if the player hasn't moved it
   0,  -- integer, required, where to put it if the player hasn't moved it
   200,  -- integer, required, how big to make it if the player hasn't moved it
   50,  -- integer, required, how big to make it if the player hasn't moved it
   "Spellup",  -- string, optional (nil means no titlebar), text to put into the title
   "center",  -- string, optional (default is "center"), "left", "center", or "right"
   false,  -- boolean, optional (default is false), true adds a close button in the top left
   false,  -- boolean, optional (default is false), make the window resizeable
   false,  -- boolean, optional (default is false), add a scrollbar and mousewheel scrolling
   false,  -- boolean, optional (default is false), make the text selectable
   false,  -- boolean, optional (default is false), make the text copyable via right-click
   false,  -- boolean, optional (default is false), turn detected URLs into clickable links
   false,  -- boolean, optional (default is false), automatically wrap text lines that are too wide
   nil,  -- string, optional (default is Dina), override the title font name
   nil,  -- integer, optional (default is 10), override the title font size
   nil,  -- string, optional (default is Dina), override the body text font name
   20,  -- integer, optional (default is 10), override the body text font size
   nil,  -- integer, optional (default is 1000), maximum number of text lines to keep
   nil,  -- integer, optional (default is 5 pixels), space between text and miniwindow frame
   nil,  -- boolean, optional (default is false), true will prevent the window from appearing until you call :show() on it
   false  -- boolean, optional (default is false), if true, pixels the same color as Theme.PRIMARY_BODY will be transparent
)



function BeginSpellup()
  spellup_length = 0
  successes = 0
  failures = 0
  barframe = " "
  loadbar = ""
  beginbar = true
  Note("Spelling up...")
  Send("spellup")
  SpellupWindow:clear()
  EnableTriggerGroup("cleanspellup", true)
  WindowShow("SpellupWindow", true)
end


function CountSpells()
  spellup_length = spellup_length + 1
  barframe = barframe .. "_"
end

function UpdateSpellupBar(result)


  if result == "success" then
    successes = successes + 1
    loadbar = loadbar .. "#"
    SpellupWindow:clear()
    SpellupWindow:add_text(loadbar)
    --Tell(loadbar)
    --ColourTell("blue", "black", "#")
  else
    failures = failures + 1
    loadbar = loadbar .. "#"
    SpellupWindow:clear()
    SpellupWindow:add_text(loadbar)
    --Tell(loadbar)
    --ColourTell("red", "black", "#")
  end

end

function ClearNewline (name, line, wildcards)
  DeleteLines (1)
  SpellupWindow:clear()
  SpellupWindow:add_text(loadbar)
  --Tell(loadbar)
  if (successes + failures) >= spellup_length then
    WindowShow("SpellupWindow", false)
    EnableTriggerGroup("cleanspellup", false)
  end
end

]]>
</script>


<triggers>
    <trigger
    enabled="n"
    group="cleanspellup"
    name="countspells"
    match="Queueing s[pk][ei]ll : (([,'\-\w]\s?)+)(?<!\s)"
    omit_from_output="y"
    regexp="y"
    send_to="12"
    sequence="100"
    >
    <send>CountSpells()</send>
    </trigger>
    <trigger
    enabled="n"
    group="cleanspellup"
    name="countfailures"
    match="^You lost your concentration.*[\r\n]{1,2}"
    omit_from_output="y"
    regexp="y"
    send_to="12"
    sequence="99"
    >
    <send>UpdateSpellupBar("failure")</send>
    </trigger>
    <trigger
    enabled="n"
    group="cleanspellup"
    name="countsuccesses"
    match="^[AY][yon\s].*"
    omit_from_output="y"
    regexp="y"
    send_to="12"
    sequence="101"
    >
    <send>UpdateSpellupBar("success")</send>
    </trigger>
    <trigger
    enabled="n"
    group="cleanspellup"
    name="clearspaces"
    match="^$"
    omit_from_output="y"
    regexp="y"
    sequence="101"
    script="ClearNewline"
    >
    </trigger>
</triggers>

</muclient>
